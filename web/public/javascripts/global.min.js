var $page=null;var Panel=null;$(document).on("pageinit",function(){if($("#go-top").length){$("#go-top").hide()}else{Panel=new GoTop();Panel.init({pageWidth:$(window).width(),topNodeId:"go-top",smtNodeId:"smt-form",nodeWidth:50,distanceToBottom:125,hideRegionHeight:130,distanceToPage:20,zIndex:100,text:" "})}});$(document).on("pagebeforeshow",function(){if(typeof window.history.replaceState==="function"){window.history.replaceState(null,null,"/")}});$(document).on("pageload",function(){setTimeout(function(){$page.trigger("click")},1500)});$(document).on("pageshow","#mesgDetail",function(){createGraphy()});$(document).on("pageshow","#pageHomepage",function(){if($("#pageGlance").length){$("#pageGlance").remove()}});$(document).on("pageshow","#pageGlance",function(){if($("#pageHomepage").length){$("#pageHomepage").remove()}});$(document).on("pagecreate",function(b){$page=$(b.target);var a=$page.attr("id");if(a=="mesgDetail"){}else{createFooter($page,a);pageRefresh()}});$(document).on("click","#following-dialog .ui-icon-delete",function(a){$(this).attr("href","/profile")});function pageRefresh(){$.mobile.pageContainer.trigger("create")}function createFooter(a,d){var c=a.attr("data-footer");if(c){var b="";if(!b){b=urlLoadContent(c)}a.append(b);if(d=="pageGlance"){a.find('a[data-icon="grid"]').attr("class","ui-btn-active ui-state-persist").attr("href","#");a.find('a[data-icon="plus"]').attr("href","/subscribe").attr("data-transition","slide");a.find('a[data-icon="gear"]').attr("href","/profile").attr("data-transition","slide")}else{if(d=="profile"){a.find('a[data-icon="grid"]').attr("href","#pageGlance").attr("data-transition","slide").attr("data-direction","reverse");a.find('a[data-icon="plus"]').attr("href","/subscribe").attr("data-transition","slide").attr("data-direction","reverse");a.find('a[data-icon="gear"]').attr("class","ui-btn-active ui-state-persist").attr("href","#")}else{if(d=="pageSubscribe"){a.find('a[data-icon="grid"]').attr("href","#pageGlance").attr("data-transition","slide").attr("data-direction","reverse");a.find('a[data-icon="plus"]').attr("href","#").attr("class","ui-btn-active ui-state-persist");a.find('a[data-icon="gear"]').attr("href","/profile").attr("data-transition","slide")}else{if(d=="pageHomepage"){a.find('a[data-icon="grid"]').attr("href","/login").attr("data-rel","dialog");a.find('a[data-icon="plus"]').attr("href","/login").attr("data-rel","dialog");a.find('a[data-icon="gear"]').attr("href","/login").attr("data-rel","dialog")}}}}}}var urlLoadContent=function(a){var b="";$.ajax({url:a,type:"GET",dataType:"html",async:false,success:function(c,e,d){b=c},error:function(d,e,c){b=""}});return b};function showLoader(){$.mobile.loading("show",{textVisible:true,dataType:"json",theme:"a",textonly:false,html:""})}function hideLoader(){$.mobile.loading("hide")}function popOver(b,c){$('<div data-role="popup" id="popupDialog" data-confirmed="yes" data-transition="pop" data-overlay-theme="a" data-theme="a" class="g-popover"><div data-role="header" data-theme="b"><h1>亲!</h1></div><div role="main" class="ui-content"><h3 class="ui-title">'+b+"</h3></div></div>").appendTo($.mobile.pageContainer);var a=$("#popupDialog");a.trigger("create");a.popup({history:false,afterclose:function(e,f){a.find(".optionConfirm").first().off("click");var d=a.attr("data-confirmed")==="yes"?true:false;$(e.target).remove();if(d&&c){c()}}});a.popup("open");setTimeout(function(){a.popup("close")},1500)}function sendAjaxRequest(a){$.ajax({async:true,timeout:5000,type:"post",url:a["url"],dataType:"json",contentType:"application/json",beforeSend:function(){a["before"]()},success:function(b){a["success"](b)},complete:function(){a["complete"]()},error:function(b,d,c){if(d==="timeout"){popOver("连接超时，稍后再试下嘛！")}a["error"]()}})}function ajax_success(a){if(a.response===1){popOver("Sorry，稍后再试下嘛！")}if(a.response===0){popOver("恭喜！成功了yeah～")}}function ajax_error(){popOver("链路失败，稍后再试下嘛！")}function showGraphy(t){var l=[],o=[],i,n=t.response,c=new Date(),r=c.getTime();if(n.length){o=t.response.split("\n");var e=o.length-1;var u=[];var q=0;for(var f=0;f<1440;f++){var p=r-f*1000*60;var d=new Date(p);var m=d.getMonth()+1;var i=d.getFullYear()+"-"+m+"-"+d.getDate()+"-"+d.getHours()+"-"+d.getMinutes();u=e>=0?o[e].split(":"):[];var g=1440-f;if(u.length==2&&i==u[0]){e--;l.push([g,u[1]]);if(parseInt(u[1])>parseInt(q)){q=u[1]}}else{l.push([g,0])}}}var h=q>0?q:2;var k=r-1440*1000*60;var s=function(w,x){if(typeof x=="number"){if((""+x).indexOf(".")===-1){var v=new Date(k+x*60*1000);return v.getDate()+"-"+v.getHours()+":"+v.getMinutes()}return""}else{return String(x)}};var b=[0];for(var j=1;j<11;j++){b.push(parseInt(h*j/10))}b.push(Math.ceil(h*1.05));var a={axes:{xaxis:{min:0,max:1440,pad:1,tickOptions:{formatter:s}},yaxis:{min:0,ticks:b,},},seriesDefaults:{showMarker:false,lineWidth:0.5,shadowOffset:1,},title:{text:"24小时内报警分布图",show:true,},};$.jqplot("plotChart",[l.reverse()],a)}function createGraphy(){var a=$(".hermesName").text();var b={url:encodeURI("/ajaxGetRecords?hermes="+a),before:function(){},success:showGraphy,complete:function(){},error:function(){}};
sendAjaxRequest(b)}function submitSubForm(a){a.find('input[type="button"]').trigger("click")};