function ajaxFormSubmit(b){var c="";var a="";var d=$(b.target).closest(".subscribe-box");$.each(d.find(".ui-checkbox"),function(h,f){var e=$(f).find('input[type="checkbox"]').attr("name");var g=$(f).find("label").hasClass("ui-checkbox-on")?1:0;if(c){a="&"+e+"="+g}else{a="?"+e+"="+g}c=c+a});c=c+"&hermesID="+d.find('input[name="hermesID"]').val();$.ajax({timeout:3000,async:true,dataType:"json",url:"/ajaxBookSubscribe"+c,beforeSend:showLoader,success:function(e){var f="";if(e.response===1){f="<p>订阅失败，稍后再试!</p>"}else{if(e.response===0){f="<p>订阅成功!</p>"}}d.find(".mesg-box").html(f)},error:function(e,h,f){var g="<p>链接失败，稍后再试!</p>";d.find(".mesg-box").html(g)},complete:function(){d.find(".mesg-box").show();hideLoader()},})}function ajaxGetSubDetail(b){var a=b;$.ajax({timeout:2000,async:true,dataType:"json",url:"/ajaxGetSubDetail?group="+a.attr("data-name"),beforeSend:showLoader,success:function(c){var d="";if(c.subDetail!=null&&c.subDetail.length>0){d='<div class="subscribe-box"><fieldset data-role="controlgroup">';$.each(c.subDetail,function(f,e){d=d+'<label for="'+e.name+'">'+e.name+"</label>";if(e.booked){d=d+'<input type="checkbox" name="'+e.name+'" id="'+e.name+'" checked="checked">'}else{d=d+'<input type="checkbox" name="'+e.name+'" id="'+e.name+'">'}});d=d+"</fieldset>";d=d+'<input type="hidden" name="hermesID" value="'+a.attr("data-name")+'">';d=d+'<input type="button" onclick="ajaxFormSubmit(event)" value="提交选择">';d=d+'<div class="mesg-box" style="display:none"></div></div>'}else{d="<p>无法获得订阅信息!</p>"}a.find(".content").html(d).trigger("create")},error:function(c,f,d){var e="<p>获取数据有误</p>";a.find(".content").prepend(e).trigger("create")},complete:hideLoader,})}function showLoader(){$.mobile.loading("show",{text:"数据加载中，请稍候",textVisible:true,dataType:"json",theme:"a",textonly:false,html:""})}function hideLoader(){$.mobile.loading("hide")}$(document).ready(function(){$(".sub-collapse").collapsible({expand:function(a,b){ajaxGetSubDetail($(a.target))}})});
