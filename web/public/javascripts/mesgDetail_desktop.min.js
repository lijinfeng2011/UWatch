var pullUpEl=document.getElementById("pullUp"),pullDownEl=document.getElementById("pullDown"),$mesgList=$("#contentList1"),$filterRow=null;$(document).on("pagebeforeshow","#mesgDetail",function(){if(sessionStorage.getItem("glanceView")=="oncall"){$("#cancelBtn").attr("disabled","true")}});function pullUpAction(a){setTimeout(function(){var d="",c=0;$.each(a.response,function(f,e){c++;d=d+'<li class="gary"><button data-role="none" class="filterBtn" disabled="disabled">屏蔽1小时</button><span class="index hide">';d=d+e.idx;d=d+'</span><span class="node hide">';d=d+e.node;d=d+"</span> ";d=d+e.content;d=d+"</li>"});if(c>0){var b=parseInt($(".listHeader").find(".count").text())+c;$(".listHeader").find(".count").text(b)}$mesgList.append(d).listview("refresh");pullUpEl.className="";pullUpEl.querySelector(".pullUpLabel").innerHTML="点击此处获取历史数据..."},100)}function pullDownAction(a){setTimeout(function(){var d="",c=0;$.each(a.response,function(f,e){c++;d=d+'<li data-swipeurl="#"><button data-role="none" class="filterBtn" onclick="filter(event)">屏蔽1小时</button><span class="index hide">';d=d+e.idx;d=d+'</span><span class="node hide">';d=d+e.node;d=d+"</span> ";d=d+e.content;d=d+"</li>"});$mesgList.find("li").removeClass("gary").addClass("gary");$(".filterBtn").attr("disabled","true");var b=parseInt($(".listHeader").find(".count").text())+c;$(".listHeader").find(".count").text(b);$mesgList.prepend(d).listview("refresh");pullDownEl.className="";pullDownEl.querySelector(".pullDownLabel").innerHTML="点击此处获取最新数据..."},100)}function getHistory(){pullUpEl.className="loading";pullUpEl.querySelector(".pullUpLabel").innerHTML="加载中...";var a=$("#contentList1>li:last").find(".index").text();sendAjaxRequest({url:"/ajaxGetMessage?type=old&id="+$(".hermesName").text()+"&pos="+a,before:function(){},success:pullUpAction,complete:function(){},error:function(){}})}function getNew(){pullDownEl.className="loading";pullDownEl.querySelector(".pullDownLabel").innerHTML="加载中...";sendAjaxRequest({url:"/ajaxGetMessage?type=new&id="+$(".hermesName").text(),before:function(){},success:pullDownAction,complete:function(){},error:function(){}})}function cancelSub(d){var a=d.split(/\./);if(a.length<2){return}var b=a[0];var c=d.substring(b.length+1,d.length);sendAjaxRequest({url:"/ajaxBookSubscribe?hermesID="+b+"&"+c+"=0",before:showLoader,success:responseCancel,complete:hideLoader,error:ajax_error})}function responseCancel(a){if(a.response===1){popOver("Sorry，稍后再试下嘛！")}else{if(a.response===0||a.response===3){$("#contentList1").find("li").removeClass("gary").addClass("gary");$("#cancelBtn").attr("disabled","true").text("取消成功");popOver("取消订阅成功了yeah～")}}}function filter(b){$filterRow=$(b.target).closest("li");var a=$filterRow.find(".node").text();sendAjaxRequest({url:"/ajaxSetFilterMessage?name="+$(".hermesName").text()+"&node="+a,before:function(){},complete:function(){},error:function(){},success:updateFilter})}function updateFilter(a){if(a.response==0&&$filterRow){$filterRow.removeClass("green").addClass("green")}$filterRow=null};