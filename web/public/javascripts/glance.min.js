(function(e){var b=null,k=null,j=null,f=null,i=null;e(document).on("pagebeforeshow","#pageGlance",function(){k=e("#selfList");j=e("#selfPanel");f=e("#oncallList");i=e("#oncallPanel");e(".message-link").unbind("click").bind("click",d);e("#self_link").unbind("click").bind("click",g);e("#oncall_link").unbind("click").bind("click",c);if(i.length==0){sessionStorage.setItem("glanceView","self")}else{if(sessionStorage.getItem("glanceView")==null){sessionStorage.setItem("glanceView","self")}}if(sessionStorage.getItem("glanceView")=="self"){e("#self_link").addClass("ui-btn-active");i.addClass("ui-mobile-viewport-transitioning ui-page hide list-position")}else{e("#oncall_link").addClass("ui-btn-active");j.addClass("ui-mobile-viewport-transitioning ui-page hide list-position")}j.unbind("animationend webkitAnimationEnd mozAnimationEnd").bind("animationend webkitAnimationEnd mozAnimationEnd",function(){if(j.attr("class").indexOf(" in")>0){j.removeClass().addClass("ui-mobile-viewport-transitioning ui-page ui-page-active list-static")}else{j.removeClass().addClass("ui-mobile-viewport-transitioning ui-page list-position")}});i.unbind("animationend webkitAnimationEnd mozAnimationEnd").bind("animationend webkitAnimationEnd mozAnimationEnd",function(){if(e(this).attr("class").indexOf(" in")>0){e(this).removeClass().addClass("ui-mobile-viewport-transitioning ui-page ui-page-active list-static")}else{e(this).removeClass().addClass("ui-mobile-viewport-transitioning ui-page list-position")}});b=setTimeout(a,1000)});function h(m,l,o,n){reverseClass=l?" reverse":"";e(n).addClass(m+" out"+reverseClass);e(o).addClass(m+" in"+reverseClass);e(o).addClass("ui-page-active");setTimeout(function(){e(n).addClass("hide")},0)}function g(){if(sessionStorage.getItem("glanceView")=="self"){return}sessionStorage.setItem("glanceView","self");e(".mesg-box").hide();h("slide",1,"#selfPanel","#oncallPanel")}function c(){if(sessionStorage.getItem("glanceView")=="oncall"){return}sessionStorage.setItem("glanceView","oncall");e(".mesg-box").hide();h("slide",0,"#oncallPanel","#selfPanel")}e(document).on("pagebeforehide","#pageGlance",function(){if(b){clearTimeout(b)}});function d(m){var l=e(m.target).closest("li");var n=l.find(".ui-li-count");l.removeClass("gary").addClass("gary");l.find("a").removeClass("gary").addClass("gary");n.text("0").removeClass("zero-number gary").addClass("zero-number gary")}function a(){e.ajax({timeout:3000,async:true,dataType:"json",url:"/ajaxGetMessageGroup?type="+sessionStorage.getItem("glanceView"),success:function(o){var n=sessionStorage.getItem("glanceView");var r=n=="self"?k:f;r.empty();if(o.mesgGrp!=null&&o.mesgGrp.length>0){e(".mesg-box").hide();var q="",l="",m="";if(n=="oncall"){e.each(o.mesgGrp,function(t,s){if(s.count==0){l=l+'<li data-icon="false" name="'+s.name+'"><a href="/mesgDetail?type=old&id='+s.name+'" class="message-link gary" data-transition="flip">'+s.name+'<span class="gary"> ('+s.biz+")</span></a></li>"}else{q=q+'<li data-icon="false" name="'+s.name+'"><a href="/mesgDetail?type=new&id='+s.name+'" class="message-link" data-transition="flip">'+s.name+'<span class="gary"> ('+s.biz+')</span></a><span class="ui-li-count">'+s.count+"</span></li>"}})}else{e.each(o.mesgGrp,function(t,s){if(s.count==0){l=l+'<li data-icon="false" name="'+s.name+'"><a href="/mesgDetail?type=old&id='+s.name+'" class="message-link gary" data-transition="flip">'+s.name+"</a></li>"}else{q=q+'<li data-icon="false" name="'+s.name+'"><a href="/mesgDetail?type=new&id='+s.name+'" class="message-link" data-transition="flip">'+s.name+'</a><span class="ui-li-count">'+s.count+"</span></li>"}})}if(q.length){m=q}if(l.length){m=m+l}if(m.length){r.append(m)}r.listview("refresh");e(".message-link").unbind("click").bind("click",d)}else{var p="<p>无最新报警信息!</p>";e(".mesg-box").html(p).show()}},error:function(l,o,m){var n="<p>网络连接失效，无法获取最新信息!</p>";e(".mesg-box").html(n).show()},complete:function(){b=setTimeout(a,20000)},})}})(jQuery);