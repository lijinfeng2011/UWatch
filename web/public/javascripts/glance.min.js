(function(c){var d=null;c(document).on("pagebeforeshow","#pageHomepage",function(){window.history.replaceState(null,null,"/")});c(document).on("pagebeforeshow","#pageSubscribe",function(){window.history.replaceState(null,null,"/")});c(document).on("pagebeforeshow","#pageGlance",function(){window.history.replaceState(null,null,"/");c(".message-link").unbind("click").bind("click",a);d=setTimeout(b,1000)});c(document).on("pagebeforeshow","#mesgDetail",function(){window.history.replaceState(null,null,"/")});c(document).on("pagebeforeshow","#pageLogin",function(){window.history.replaceState(null,null,"/")});c(document).on("pagebeforeshow","#profile",function(){window.history.replaceState(null,null,"/")});c(document).on("pagebeforehide","#pageGlance",function(){if(d){clearTimeout(d)}});function a(f){var e=c(f.target).closest("li");var g=e.find(".ui-li-count");e.removeClass("disable-font").addClass("disable-font");e.find("a").removeClass("disable-font").addClass("disable-font");g.text("0").removeClass("zero-number disable-font").addClass("zero-number disable-font")}function b(){c.ajax({timeout:3000,async:true,dataType:"json",url:"/ajaxGetMessageGroup",success:function(g){c(".zero-number").closest("li").remove();c("#mainList li a").removeClass("disable-font").addClass("disable-font");c("#mainList li .ui-li-count").removeClass("disable-font").addClass("disable-font");if(g.mesgGrp!=null&&g.mesgGrp.length>0){c(".mesg-box").hide();var f="",e=c("#mainList");c.each(g.mesgGrp,function(k,i){var j=c('li[name="'+i.name+'"]');if(j.length){j.find("a").removeClass("disable-font");j.find(".ui-li-count").removeClass("disable-font").text(i.count)}else{f=f+'<li name="'+i.name+'"><a href="/mesgDetail?id='+i.name+'" class="message-link" data-transition="flip">'+i.name+'</a><span class="ui-li-count">'+i.count+"</span></li>"}});if(f.length){e.prepend(f)}e.listview("refresh");c(".message-link").unbind("click").bind("click",a)}else{var h="<p>没有最新报警信息!</p>";c(".mesg-box").html(h).show()}},error:function(e,h,f){var g="<p>网络连接失效，无法获取最新信息!</p>";c(".mesg-box").html(g).show()},complete:function(){d=setTimeout(b,20000)},})}})(jQuery);
