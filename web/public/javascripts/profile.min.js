$(document).on("pageload","#profile",function(){$("#methodBtn").click(ajaxSubmitMethod)});$(document).on("pageshow","#profile",function(){$(".filter-collapse").collapsible({expand:function(b,c){getFilterItems()},collapse:function(b,c){$("#filterList").empty()}});var a=$("#alarmValue").hasClass("ui-checkbox-on")?"on":"off";if(a=="off"){$(".alarm-change input[name='fullFormat']").checkboxradio("disable");$("#alarm-form input[type='button']").button("disable");$("#alarm-form input[type='text']").textinput("disable");$("#alarm-form input[type='tel']").textinput("disable");$("#alarm-form label").css("color","#aaa")}else{$(".alarm-change input[name='fullFormat']").checkboxradio("enable");$("#alarm-form input[type='button']").button("enable");$("#alarm-form input[type='text']").textinput("enable");$("#alarm-form input[type='tel']").textinput("enable");$("#alarm-form label").css("color","")}});function getFilterItems(){sendAjaxRequest({url:"/ajaxGetFilterItems",before:showLoader,success:a,complete:hideLoader,error:ajax_error});function a(c){var b=$("#filterList");$.each(c.response,function(i,f){var h=$("<li></li>").appendTo(b);var e=$('<div data-role="collapsible" class="filter-collapse" data-name="'+i+'">');$('<h3 style="margin: 0;"><span class="item">'+i+"</span></h3>").appendTo(e);var d=$('<div class="subscribe-box"></div>');var g=$('<fieldset data-role="controlgroup"></fieldset>').appendTo(d);$.each(f,function(j,k){var l=k.split(":");$('<label for="'+l[0]+'">'+l[0]+" (by:"+l[1]+")</label>").appendTo(g);if(l[2]=="1"){$('<input type="checkbox" name="'+l[0]+'" id="'+l[0]+'" onclick="filterRequest(event)" checked="checked">').appendTo(g)}else{$('<input type="checkbox" name="'+l[0]+'" id="'+l[0]+'" disabled="disabled" checked="checked">').appendTo(g)}});d.appendTo($('<div class="content"></div>').appendTo(e));e.appendTo(h)});$(".filter-collapse").collapsible();$(".content").trigger("create")}}function filterRequest(e){var b=e.target.checked?1:0;var d=e.target.id,a=$(e.target).closest(".filter-collapse").attr("data-name");if(b==1){sendAjaxRequest({url:"/ajaxSetFilterMessage?name="+a+"&node="+d,before:showLoader,success:f,complete:hideLoader,error:ajax_error})}else{sendAjaxRequest({url:"/ajaxDelFilterMessage?name="+a+"&node="+d,before:showLoader,success:c,complete:hideLoader,error:ajax_error})}function c(g){if(g.response===1){popOver("Sorry，稍后再试下嘛！")}if(g.response===0){popOver("取消屏蔽成功!")}}function f(g){if(g.response===1){popOver("Sorry，稍后再试下嘛！")}if(g.response===0){popOver("屏蔽成功!")}}}function ajaxSubmitMethod(){var a=[];$.each($("#alarm-form input"),function(e,c){var d=$(c);if(d.val()&&(d.attr("type")=="tel"||d.attr("type")=="text")){a.push(d.attr("name")+"-"+d.val())}});if(a.length==0){popOver("留个报警方式呗～");return}sendAjaxRequest({url:"/ajaxSetMethod?value="+a.join(":"),before:showLoader,success:b,complete:hideLoader,error:ajax_error});function b(c){if(c.response===1){popOver("Sorry，稍后再试下嘛！");return}if(c.response===0){popOver("接收报警方式设置成功～")}}}function ajaxSubmitProfile(b){var e="",a="",d=false;var c=$(b.target).closest("#profile-form");$.each(c.find("input"),function(j,f){var h=$(f).attr("type"),i=$(f).val();if(h=="tel"&&!i.match(/^0?1[3|4|5|8][0-9]\d{8}$/)){popOver("留个手机号码呗～");d=true;return false}if(h=="tel"||h=="text"||h=="number"){if($(f).val().length==0&&$(f).attr("name")!="oncaller"){popOver("要填写完整呦～");d=true;return false}var g=e?"&":"?";g=g+$(f).attr("name")+"="+$(f).val();e=e+g}});if(d){return false}$.each(c.find("option:selected"),function(g,f){if(a.length){a=a+":"+$(f).val()}else{a=a+$(f).val()}});if(a.length){e=e+"&follower="+a}sendAjaxRequest({url:encodeURI("/ajaxSetProfile"+e),before:showLoader,success:ajax_success,complete:hideLoader,error:ajax_error})}function triggerAlarm(){var a=$("#alarmValue").hasClass("ui-checkbox-on")?"off":"on";sendAjaxRequest({url:"/ajaxSetAlarm?value="+a,before:showLoader,success:b,complete:hideLoader,error:ajax_error});function b(d){var c=$("#alarmValue").hasClass("ui-checkbox-on")?"off":"on";if(d.response===1){popOver("Sorry，稍后再试下嘛！")}else{if(d.response===0){if(c=="on"){$(".alarm-change input[name='fullFormat']").checkboxradio("disable");$("#alarm-form input[type='button']").button("disable");$("#alarm-form input[type='text']").textinput("disable");$("#alarm-form input[type='tel']").textinput("disable");$("#alarm-form label").css("color","#aaa")}else{$(".alarm-change input[name='fullFormat']").checkboxradio("enable");$("#alarm-form input[type='button']").button("enable");$("#alarm-form input[type='text']").textinput("enable");$("#alarm-form input[type='tel']").textinput("enable");$("#alarm-form label").css("color","")}popOver("恭喜！成功了yeah～")}}}}function triggerTest(){sendAjaxRequest({url:"/ajaxTriggerTest",before:showLoader,success:ajax_success,complete:hideLoader,error:ajax_error})}function triggerFormat(){var a=$("#formatValue").hasClass("ui-checkbox-on")?"off":"on";sendAjaxRequest({url:"/ajaxSetFormat?value="+a,before:showLoader,success:ajax_success,complete:hideLoader,error:ajax_error})
}function ajaxChangePWD(b){if($('input[name="new-pwd"]').val()!=$('input[name="confirm-pwd"]').val()){popOver("两次密码不一样呦～");return false}var c=false;$.each($('input[type="password"]'),function(j,g){var i=$(g).val();if(i.length<6){popOver("长度不小于6位呦～");c=true;return false}var h=new RegExp("[a-zA-Z]");if(!h.test(i)){popOver("至少包含一个字母呦～");c=true;return false}h=new RegExp("[0-9]");if(!h.test(i)){popOver("至少包含一个数字呦～");c=true;return false}h=new RegExp("[/#?@]");if(h.test(i)){popOver("不能包含/#?@符号呦～");c=true;return false}});if(c){return false}var a=$.md5($('input[name="old-pwd"]').val());var f=$.md5($('input[name="new-pwd"]').val());var d="?old="+a+"&new="+f;sendAjaxRequest({url:"/ajaxChangePWD"+d,before:showLoader,success:e,complete:hideLoader,error:ajax_error});function e(g){var h="";if(g.response===1){popOver("修改失败，稍后再试!")}else{if(g.response===0){popOver("修改成功!")}else{if(g.response===2){popOver("原始密码错误")}}}}};