var myScroll,pullDownEl,pullDownOffset,pullUpEl,pullUpOffset,generatedCount=0;var $filterRow;function pullDownAction(b){var a=$("#contentList1");setTimeout(function(){var e="",d=0;$.each(b.response,function(g,f){d++;e=e+'<li data-swipeurl="#"><span class="index hide">';e=e+f.idx;e=e+'</span><span class="node hide">';e=e+f.node;e=e+"</span>";e=e+f.content;e=e+"</li>"});a.find("li").removeClass("gary").addClass("gary");var c=parseInt($(".listHeader").find(".count").text())+d;$(".listHeader").find(".count").text(c);a.prepend(e).listview("refresh");myScroll.refresh();bindSwipeEvent($("#contentList1 li"))},100)}function pullUpAction(a){setTimeout(function(){var d="",c=0;$.each(a.response,function(f,e){c++;d=d+'<li class="gary"> <span class="index hide">';d=d+e.idx;d=d+'</span><span class="node hide">';d=d+e.node;d=d+"</span>";d=d+e.content;d=d+"</li>"});if(c>0){var b=parseInt($(".listHeader").find(".count").text())+c;$(".listHeader").find(".count").text(b)}$("#contentList1").append(d).listview("refresh");myScroll.refresh()},100)}function loaded2(){if(myScroll!=null){myScroll.destroy()}pullDownEl=document.getElementById("pullDown");pullDownOffset=pullDownEl.offsetHeight;pullUpEl=document.getElementById("pullUp");pullUpOffset=pullUpEl.offsetHeight;myScroll=new iScroll("wrapperContent1",{scrollbarClass:"myScrollbar",useTransition:false,topOffset:pullDownOffset,onRefresh:function(){if(pullDownEl.className.match("loading")){pullDownEl.className="";pullDownEl.querySelector(".pullDownLabel").innerHTML="下拉获取最新数据..."}else{if(pullUpEl.className.match("loading")){pullUpEl.className="";pullUpEl.querySelector(".pullUpLabel").innerHTML="上拉获取历史数据..."}}},onScrollMove:function(){if(this.y>5&&!pullDownEl.className.match("flip")&&!$("#cancelBtn").attr("disabled")){pullDownEl.className="flip";pullDownEl.querySelector(".pullDownLabel").innerHTML="松手开始更新...";this.minScrollY=0}else{if(this.y<5&&pullDownEl.className.match("flip")){pullDownEl.className="";pullDownEl.querySelector(".pullDownLabel").innerHTML="下拉获取最新数据...";this.minScrollY=-pullDownOffset}else{if(this.y<(this.maxScrollY-5)&&!pullUpEl.className.match("flip")){pullUpEl.className="flip";pullUpEl.querySelector(".pullUpLabel").innerHTML="松手开始更新...";this.maxScrollY=this.maxScrollY}else{if(this.y>(this.maxScrollY+5)&&pullUpEl.className.match("flip")){pullUpEl.className="";pullUpEl.querySelector(".pullUpLabel").innerHTML="上拉获取历史数据...";this.maxScrollY=pullUpOffset}}}}},onScrollEnd:function(){if(pullDownEl.className.match("flip")){pullDownEl.className="loading";pullDownEl.querySelector(".pullDownLabel").innerHTML="加载中...";var b={url:"/ajaxGetMessage?type=new&id="+$(".hermesName").text(),before:function(){},success:pullDownAction,complete:function(){},error:function(){}};unbindSwipeEvent($("#contentList1 li"));sendAjaxRequest(b)}else{if(pullUpEl.className.match("flip")){pullUpEl.className="loading";pullUpEl.querySelector(".pullUpLabel").innerHTML="加载中...";var a=$("#contentList1>li:last").find(".index").text();var b={url:"/ajaxGetMessage?type=old&id="+$(".hermesName").text()+"&pos="+a,before:function(){},success:pullUpAction,complete:function(){},error:function(){}};sendAjaxRequest(b)}}}});setTimeout(function(){document.getElementById("wrapperContent1").style.left="0"},800)}$(document).on("pagebeforeshow","#mesgDetail",function(){setTimeout(loaded2,1000);if(sessionStorage.getItem("glanceView")=="oncall"){$("#cancelBtn").attr("disabled","true")}});$(document).ready(function(){bindSwipeEvent($("#contentList1 li"))});function unbindSwipeEvent(a){a.filter("[data-swipeurl]").each(function(b,c){$(c).off("swipe")})}function bindSwipeEvent(a){a.swipeDelete({btnTheme:"b",btnLabel:"屏蔽1小时",btnClass:"aSwipeButton",click:function(f){f.preventDefault();$filterRow=$(f.target).closest("li");var c=$filterRow.find(".node").text();var b=$(".hermesName").text();var d={url:"/ajaxSetFilterMessage?name="+b+"&node="+c,before:function(){},complete:function(){},error:function(){},success:updateFilter};sendAjaxRequest(d)}})}function updateFilter(a){if(a.response==0&&$filterRow){$filterRow.removeClass("green").addClass("green")}$filterRow=null}function cancelSub(e){var a=e.split(/\./);if(a.length<2){return}var b=a[0];var c=e.substring(b.length+1,e.length);var d={url:"/ajaxBookSubscribe?hermesID="+b+"&"+c+"=0",before:showLoader,success:responseCancel,complete:hideLoader,error:ajax_error};sendAjaxRequest(d)}function responseCancel(a){if(a.response===1){popOver("Sorry，稍后再试下嘛！")}else{if(a.response===0||a.response===3){$("#contentList1").find("li").removeClass("gary").addClass("gary");$("#cancelBtn").attr("disabled","true").text("取消成功");popOver("取消订阅成功了yeah～")}}};